<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Test CRUD Progetti Admin - Portfolio Vincenzo Rocca</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%); min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .header { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); color: white; padding: 30px; border-radius: 20px; text-align: center; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.2); }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        
        .test-card { background: white; border-radius: 20px; padding: 30px; margin-bottom: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); border: 1px solid #e5e7eb; }
        .test-header { font-size: 1.5rem; font-weight: 600; color: #374151; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #374151; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #8b5cf6; box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1); }
        .form-group textarea { min-height: 120px; resize: vertical; }
        
        .btn { padding: 12px 24px; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s; margin-right: 12px; margin-bottom: 12px; display: inline-flex; align-items: center; gap: 8px; font-size: 16px; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; transform: translateY(-2px); }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; transform: translateY(-2px); }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; transform: translateY(-2px); }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; transform: translateY(-2px); }
        
        .status { padding: 16px; border-radius: 12px; margin: 16px 0; font-weight: 500; }
        .status-success { background: #dcfce7; color: #16a34a; border: 1px solid #bbf7d0; }
        .status-error { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .status-info { background: #dbeafe; color: #2563eb; border: 1px solid #bfdbfe; }
        .status-warning { background: #fef3c7; color: #d97706; border: 1px solid #fed7aa; }
        
        .project-card { background: #f8fafc; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; margin-bottom: 16px; transition: all 0.3s; }
        .project-card:hover { border-color: #8b5cf6; transform: translateY(-2px); }
        .project-title { font-size: 1.25rem; font-weight: 600; color: #374151; margin-bottom: 8px; }
        .project-tech { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0; }
        .tech-tag { background: #8b5cf6; color: white; padding: 4px 8px; border-radius: 6px; font-size: 12px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .projects-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        
        .console { background: #1f2937; color: #e5e7eb; border-radius: 12px; padding: 20px; font-family: 'Courier New', monospace; font-size: 14px; max-height: 300px; overflow-y: auto; margin-top: 20px; }
        .console-line { margin-bottom: 4px; }
        
        @media (max-width: 768px) { 
            .grid { grid-template-columns: 1fr; }
            .projects-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Test CRUD Progetti Admin</h1>
            <p>Gestione completa progetti portfolio - Create, Read, Update, Delete</p>
        </div>

        <!-- Login Admin -->
        <div class="test-card" id="login-section">
            <div class="test-header">
                <span>üîê</span>
                <span>Login Admin Richiesto</span>
            </div>
            
            <div class="form-group">
                <label>Email Admin:</label>
                <input type="email" id="admin-email" value="vincenzorocca88@gmail.com">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="admin-password" value="admin123">
            </div>
            
            <button class="btn btn-primary" onclick="loginAdmin()">
                <span>üîì</span> Login Admin
            </button>
        </div>

        <!-- Sezione CRUD (nascosta fino al login) -->
        <div id="crud-section" style="display: none;">
            
            <!-- Form Nuovo Progetto -->
            <div class="test-card">
                <div class="test-header">
                    <span>‚ûï</span>
                    <span>Crea Nuovo Progetto</span>
                </div>
                
                <div class="grid">
                    <div>
                        <div class="form-group">
                            <label>Nome Progetto *:</label>
                            <input type="text" id="project-name" placeholder="Es: E-commerce Fashion">
                        </div>
                        
                        <div class="form-group">
                            <label>Descrizione Breve *:</label>
                            <input type="text" id="project-description" placeholder="Es: Piattaforma e-commerce moderna per abbigliamento">
                        </div>
                        
                        <div class="form-group">
                            <label>URL Demo:</label>
                            <input type="url" id="project-demo-url" placeholder="https://demo.example.com">
                        </div>
                        
                        <div class="form-group">
                            <label>URL GitHub:</label>
                            <input type="url" id="project-github-url" placeholder="https://github.com/user/repo">
                        </div>
                    </div>
                    
                    <div>
                        <div class="form-group">
                            <label>Immagine URL:</label>
                            <input type="url" id="project-image-url" placeholder="https://example.com/image.jpg">
                        </div>
                        
                        <div class="form-group">
                            <label>Tecnologie (separate da virgola) *:</label>
                            <input type="text" id="project-technologies" placeholder="React, Laravel, MySQL, TailwindCSS">
                        </div>
                        
                        <div class="form-group">
                            <label>Categoria:</label>
                            <select id="project-category">
                                <option value="web">Sviluppo Web</option>
                                <option value="mobile">App Mobile</option>
                                <option value="desktop">Software Desktop</option>
                                <option value="ecommerce">E-commerce</option>
                                <option value="cms">CMS</option>
                                <option value="api">API/Backend</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Status:</label>
                            <select id="project-status">
                                <option value="completed">Completato</option>
                                <option value="in_progress">In Corso</option>
                                <option value="planned">Pianificato</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Descrizione Dettagliata:</label>
                    <textarea id="project-long-description" placeholder="Descrizione completa del progetto, sfide affrontate, soluzioni implementate..."></textarea>
                </div>
                
                <button class="btn btn-success" onclick="createProject()">
                    <span>‚ú®</span> Crea Progetto
                </button>
                <button class="btn btn-warning" onclick="fillSampleProject()">
                    <span>üéØ</span> Dati Esempio
                </button>
                <button class="btn btn-primary" onclick="createMultipleProjects()">
                    <span>üöÄ</span> Crea 5 Progetti Test
                </button>
            </div>

            <!-- Lista Progetti Esistenti -->
            <div class="test-card">
                <div class="test-header">
                    <span>üìã</span>
                    <span>Progetti Esistenti</span>
                </div>
                
                <button class="btn btn-primary" onclick="loadProjects()">
                    <span>üîÑ</span> Ricarica Progetti
                </button>
                <button class="btn btn-danger" onclick="deleteAllProjects()">
                    <span>üóëÔ∏è</span> Elimina Tutti
                </button>
                <button class="btn btn-warning" onclick="exportProjects()">
                    <span>üíæ</span> Esporta JSON
                </button>
                
                <div id="projects-list" class="projects-grid">
                    <p>üîÑ Caricamento progetti...</p>
                </div>
            </div>

            <!-- Test CRUD Avanzati -->
            <div class="test-card">
                <div class="test-header">
                    <span>üîß</span>
                    <span>Test CRUD Avanzati</span>
                </div>
                
                <div class="grid">
                    <div>
                        <h4>Test Create:</h4>
                        <button class="btn btn-success" onclick="testBulkCreate()">
                            <span>üì¶</span> Test Bulk Create
                        </button>
                        <button class="btn btn-warning" onclick="testInvalidCreate()">
                            <span>‚ùå</span> Test Dati Invalidi
                        </button>
                    </div>
                    <div>
                        <h4>Test Update/Delete:</h4>
                        <button class="btn btn-primary" onclick="testUpdateProject()">
                            <span>‚úèÔ∏è</span> Test Update
                        </button>
                        <button class="btn btn-danger" onclick="testDeleteProject()">
                            <span>üóëÔ∏è</span> Test Delete
                        </button>
                    </div>
                </div>
                
                <h4>Test Performance:</h4>
                <button class="btn btn-warning" onclick="testLargeDataset()">
                    <span>üèãÔ∏è</span> Test Dataset Grande
                </button>
                <button class="btn btn-primary" onclick="runAllCRUDTests()">
                    <span>üîÑ</span> Test CRUD Completi
                </button>
            </div>
        </div>

        <!-- Status e Console -->
        <div id="status-container"></div>
        
        <div class="test-card">
            <div class="test-header">
                <span>üñ•Ô∏è</span>
                <span>Console Debug CRUD</span>
            </div>
            
            <button class="btn btn-danger" onclick="clearConsole()">
                <span>üóëÔ∏è</span> Pulisci Console
            </button>
            
            <div id="console" class="console">
                <div class="console-line">üöÄ Test CRUD Projects - Console inizializzata</div>
                <div class="console-line">üìÖ <?= date('Y-m-d H:i:s') ?></div>
                <div class="console-line">========================</div>
            </div>
        </div>
    </div>

    <script>
        // Stato globale
        let appState = {
            isLoggedIn: false,
            user: null,
            projects: [],
            editingProject: null
        };

        // Utility functions
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            const emoji = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            const line = document.createElement('div');
            line.className = 'console-line';
            line.innerHTML = `${emoji} [${timestamp}] ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }

        function showStatus(message, type = 'info') {
            const container = document.getElementById('status-container');
            const status = document.createElement('div');
            status.className = `status status-${type}`;
            status.innerHTML = `<strong>${message}</strong>`;
            container.appendChild(status);
            
            setTimeout(() => {
                if (status.parentNode) {
                    status.parentNode.removeChild(status);
                }
            }, 5000);
        }

        // Login Admin
        async function loginAdmin() {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;

            try {
                log(`Login admin: ${email}`, 'info');
                
                const response = await fetch('/api-direct.php?endpoint=login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const result = await response.json();
                
                if (result.success && result.user && result.user.is_admin) {
                    appState.isLoggedIn = true;
                    appState.user = result.user;
                    
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('crud-section').style.display = 'block';
                    
                    showStatus(`‚úÖ Login admin effettuato: ${result.user.name}`, 'success');
                    log(`Admin login successful: ${result.user.name}`, 'success');
                    
                    // Carica progetti
                    loadProjects();
                    
                } else if (result.success && result.user && !result.user.is_admin) {
                    throw new Error('Accesso negato: privilegi admin richiesti');
                } else {
                    throw new Error(result.message || 'Login fallito');
                }
            } catch (error) {
                showStatus(`‚ùå Errore login admin: ${error.message}`, 'error');
                log(`Admin login failed: ${error.message}`, 'error');
            }
        }

        // Riempi dati esempio
        function fillSampleProject() {
            document.getElementById('project-name').value = 'E-commerce Fashion Store';
            document.getElementById('project-description').value = 'Piattaforma e-commerce moderna per abbigliamento con pagamenti integrati';
            document.getElementById('project-demo-url').value = 'https://demo-fashion.example.com';
            document.getElementById('project-github-url').value = 'https://github.com/vincenzorocca/fashion-store';
            document.getElementById('project-image-url').value = 'https://images.unsplash.com/photo-1441986300917-64674bd600d8';
            document.getElementById('project-technologies').value = 'React, Node.js, MongoDB, Stripe, TailwindCSS';
            document.getElementById('project-category').value = 'ecommerce';
            document.getElementById('project-status').value = 'completed';
            document.getElementById('project-long-description').value = 'Piattaforma e-commerce completa sviluppata con React e Node.js. Include gestione prodotti, carrello, pagamenti con Stripe, pannello admin, sistema di recensioni e notifiche email. Design responsive e performance ottimizzate.';
            
            log('Sample project data filled', 'info');
        }

        // Crea progetto
        async function createProject() {
            const projectData = {
                name: document.getElementById('project-name').value,
                description: document.getElementById('project-description').value,
                demo_url: document.getElementById('project-demo-url').value,
                github_url: document.getElementById('project-github-url').value,
                image_url: document.getElementById('project-image-url').value,
                technologies: document.getElementById('project-technologies').value,
                category: document.getElementById('project-category').value,
                status: document.getElementById('project-status').value,
                long_description: document.getElementById('project-long-description').value
            };

            // Validazione
            if (!projectData.name || !projectData.description || !projectData.technologies) {
                showStatus('‚ùå Compila i campi obbligatori (Nome, Descrizione, Tecnologie)', 'error');
                return;
            }

            try {
                log(`Creating project: ${projectData.name}`, 'info');
                
                const response = await fetch('/api-direct.php?endpoint=projects', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(projectData)
                });

                const result = await response.json();
                
                if (result.success || response.ok) {
                    showStatus(`‚úÖ Progetto "${projectData.name}" creato con successo!`, 'success');
                    log(`Project created: ${projectData.name} (ID: ${result.project_id || 'new'})`, 'success');
                    
                    // Clear form
                    document.querySelectorAll('#crud-section input, #crud-section textarea').forEach(input => {
                        if (input.type !== 'url') input.value = '';
                    });
                    
                    // Reload projects
                    setTimeout(() => loadProjects(), 1000);
                    
                } else {
                    throw new Error(result.message || 'Errore creazione progetto');
                }
            } catch (error) {
                showStatus(`‚ùå Errore creazione progetto: ${error.message}`, 'error');
                log(`Project creation failed: ${error.message}`, 'error');
            }
        }

        // Carica progetti
        async function loadProjects() {
            try {
                log('Loading projects...', 'info');
                
                const response = await fetch('/api-direct.php?endpoint=projects');
                const result = await response.json();
                
                if (result.data && Array.isArray(result.data)) {
                    appState.projects = result.data;
                    renderProjects(result.data);
                    
                    showStatus(`‚úÖ Caricati ${result.data.length} progetti`, 'success');
                    log(`Loaded ${result.data.length} projects`, 'success');
                } else {
                    throw new Error('Formato dati progetti non valido');
                }
            } catch (error) {
                showStatus(`‚ùå Errore caricamento progetti: ${error.message}`, 'error');
                log(`Error loading projects: ${error.message}`, 'error');
            }
        }

        // Renderizza progetti
        function renderProjects(projects) {
            const container = document.getElementById('projects-list');
            
            if (projects.length === 0) {
                container.innerHTML = '<p>üì≠ Nessun progetto trovato</p>';
                return;
            }
            
            let html = '';
            projects.forEach(project => {
                const technologies = project.technologies ? project.technologies.split(',').map(t => t.trim()) : [];
                
                html += `
                    <div class="project-card" data-id="${project.id}">
                        <div class="project-title">${project.name}</div>
                        <p style="color: #6b7280; margin-bottom: 12px;">${project.description}</p>
                        
                        <div class="project-tech">
                            ${technologies.map(tech => `<span class="tech-tag">${tech}</span>`).join('')}
                        </div>
                        
                        <p><strong>Categoria:</strong> ${project.category || 'N/A'}</p>
                        <p><strong>Status:</strong> ${project.status || 'N/A'}</p>
                        <p><strong>Creato:</strong> ${new Date(project.created_at).toLocaleDateString()}</p>
                        
                        <div style="margin-top: 16px;">
                            <button class="btn btn-primary" onclick="editProject(${project.id})">
                                <span>‚úèÔ∏è</span> Modifica
                            </button>
                            <button class="btn btn-danger" onclick="deleteProject(${project.id})">
                                <span>üóëÔ∏è</span> Elimina
                            </button>
                            ${project.demo_url ? `<button class="btn btn-success" onclick="window.open('${project.demo_url}', '_blank')"><span>üîó</span> Demo</button>` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Modifica progetto
        async function editProject(projectId) {
            const project = appState.projects.find(p => p.id === projectId);
            if (!project) {
                showStatus('‚ùå Progetto non trovato', 'error');
                return;
            }
            
            // Fill form with project data
            document.getElementById('project-name').value = project.name || '';
            document.getElementById('project-description').value = project.description || '';
            document.getElementById('project-demo-url').value = project.demo_url || '';
            document.getElementById('project-github-url').value = project.github_url || '';
            document.getElementById('project-image-url').value = project.image_url || '';
            document.getElementById('project-technologies').value = project.technologies || '';
            document.getElementById('project-category').value = project.category || 'web';
            document.getElementById('project-status').value = project.status || 'completed';
            document.getElementById('project-long-description').value = project.long_description || '';
            
            appState.editingProject = projectId;
            
            // Change button to update
            const createBtn = document.querySelector('button[onclick="createProject()"]');
            createBtn.onclick = () => updateProject(projectId);
            createBtn.innerHTML = '<span>üíæ</span> Aggiorna Progetto';
            createBtn.className = 'btn btn-warning';
            
            showStatus(`‚úèÔ∏è Modifica progetto: ${project.name}`, 'info');
            log(`Editing project: ${project.name} (ID: ${projectId})`, 'info');
        }

        // Aggiorna progetto
        async function updateProject(projectId) {
            const projectData = {
                name: document.getElementById('project-name').value,
                description: document.getElementById('project-description').value,
                demo_url: document.getElementById('project-demo-url').value,
                github_url: document.getElementById('project-github-url').value,
                image_url: document.getElementById('project-image-url').value,
                technologies: document.getElementById('project-technologies').value,
                category: document.getElementById('project-category').value,
                status: document.getElementById('project-status').value,
                long_description: document.getElementById('project-long-description').value
            };

            try {
                log(`Updating project ID: ${projectId}`, 'info');
                
                const response = await fetch(`/api-direct.php?endpoint=projects&id=${projectId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(projectData)
                });

                const result = await response.json();
                
                if (result.success || response.ok) {
                    showStatus(`‚úÖ Progetto aggiornato: ${projectData.name}`, 'success');
                    log(`Project updated: ${projectData.name}`, 'success');
                    
                    // Reset form
                    resetCreateForm();
                    
                    // Reload projects
                    setTimeout(() => loadProjects(), 1000);
                    
                } else {
                    throw new Error(result.message || 'Errore aggiornamento progetto');
                }
            } catch (error) {
                showStatus(`‚ùå Errore aggiornamento progetto: ${error.message}`, 'error');
                log(`Project update failed: ${error.message}`, 'error');
            }
        }

        // Elimina progetto
        async function deleteProject(projectId) {
            const project = appState.projects.find(p => p.id === projectId);
            if (!project) {
                showStatus('‚ùå Progetto non trovato', 'error');
                return;
            }
            
            if (!confirm(`Sei sicuro di voler eliminare il progetto "${project.name}"?`)) {
                return;
            }

            try {
                log(`Deleting project: ${project.name} (ID: ${projectId})`, 'warning');
                
                const response = await fetch(`/api-direct.php?endpoint=projects&id=${projectId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();
                
                if (result.success || response.ok) {
                    showStatus(`‚úÖ Progetto eliminato: ${project.name}`, 'success');
                    log(`Project deleted: ${project.name}`, 'success');
                    
                    // Reload projects
                    setTimeout(() => loadProjects(), 1000);
                    
                } else {
                    throw new Error(result.message || 'Errore eliminazione progetto');
                }
            } catch (error) {
                showStatus(`‚ùå Errore eliminazione progetto: ${error.message}`, 'error');
                log(`Project deletion failed: ${error.message}`, 'error');
            }
        }

        // Reset form creazione
        function resetCreateForm() {
            document.querySelectorAll('#crud-section input, #crud-section textarea').forEach(input => {
                if (input.type !== 'url') input.value = '';
            });
            
            const createBtn = document.querySelector('button[onclick*="Project"]');
            createBtn.onclick = createProject;
            createBtn.innerHTML = '<span>‚ú®</span> Crea Progetto';
            createBtn.className = 'btn btn-success';
            
            appState.editingProject = null;
        }

        // Crea progetti multipli
        async function createMultipleProjects() {
            log('Creating multiple test projects...', 'info');
            showStatus('üîÑ Creazione 5 progetti di test...', 'info');
            
            const testProjects = [
                {
                    name: 'Portfolio React',
                    description: 'Portfolio personale sviluppato con React e Laravel',
                    technologies: 'React, Laravel, MySQL, TailwindCSS',
                    category: 'web',
                    status: 'completed'
                },
                {
                    name: 'App Mobile Restaurant',
                    description: 'App mobile per ordinazioni ristorante',
                    technologies: 'React Native, Node.js, MongoDB',
                    category: 'mobile',
                    status: 'in_progress'
                },
                {
                    name: 'CMS Custom',
                    description: 'Sistema di gestione contenuti personalizzato',
                    technologies: 'Vue.js, PHP, PostgreSQL',
                    category: 'cms',
                    status: 'completed'
                },
                {
                    name: 'API Gateway',
                    description: 'Gateway API per microservizi',
                    technologies: 'Node.js, Docker, Redis, JWT',
                    category: 'api',
                    status: 'planned'
                },
                {
                    name: 'E-learning Platform',
                    description: 'Piattaforma per corsi online',
                    technologies: 'Next.js, Prisma, Stripe, AWS',
                    category: 'web',
                    status: 'in_progress'
                }
            ];
            
            for (let project of testProjects) {
                document.getElementById('project-name').value = project.name;
                document.getElementById('project-description').value = project.description;
                document.getElementById('project-technologies').value = project.technologies;
                document.getElementById('project-category').value = project.category;
                document.getElementById('project-status').value = project.status;
                
                await createProject();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            showStatus('‚úÖ Creati 5 progetti di test', 'success');
        }

        // Test CRUD completi
        async function runAllCRUDTests() {
            log('=== STARTING COMPREHENSIVE CRUD TEST SUITE ===', 'info');
            showStatus('üîÑ Esecuzione test CRUD completi...', 'info');
            
            const tests = [
                () => testBulkCreate(),
                () => testInvalidCreate(),
                () => testUpdateProject(),
                () => testDeleteProject()
            ];

            let passed = 0;
            let failed = 0;

            for (const test of tests) {
                try {
                    await test();
                    passed++;
                } catch (error) {
                    failed++;
                }
                await new Promise(resolve => setTimeout(resolve, 2000));
            }

            log(`=== CRUD TEST SUITE COMPLETED: ${passed} passed, ${failed} failed ===`, 'info');
            showStatus(`‚úÖ Test CRUD completi: ${passed} successi, ${failed} fallimenti`, 'success');
        }

        // Altri test functions
        async function testBulkCreate() {
            log('Testing bulk project creation...', 'info');
            await createMultipleProjects();
        }

        async function testInvalidCreate() {
            log('Testing invalid project creation...', 'warning');
            
            // Test with empty required fields
            document.getElementById('project-name').value = '';
            document.getElementById('project-description').value = '';
            document.getElementById('project-technologies').value = '';
            
            try {
                await createProject();
                showStatus('‚ùå PROBLEMA: Dati invalidi accettati!', 'error');
            } catch (error) {
                showStatus('‚úÖ Validazione: Dati invalidi respinti', 'success');
            }
            
            resetCreateForm();
        }

        async function testUpdateProject() {
            if (appState.projects.length > 0) {
                await editProject(appState.projects[0].id);
                document.getElementById('project-name').value += ' - UPDATED';
                await updateProject(appState.projects[0].id);
            } else {
                showStatus('‚ö†Ô∏è Nessun progetto da aggiornare', 'warning');
            }
        }

        async function testDeleteProject() {
            if (appState.projects.length > 0) {
                const lastProject = appState.projects[appState.projects.length - 1];
                if (confirm(`Test delete: eliminare "${lastProject.name}"?`)) {
                    await deleteProject(lastProject.id);
                }
            } else {
                showStatus('‚ö†Ô∏è Nessun progetto da eliminare', 'warning');
            }
        }

        async function testLargeDataset() {
            log('Testing large dataset performance...', 'warning');
            showStatus('üèãÔ∏è Test performance con dataset grande...', 'warning');
            
            // Simula test con molti progetti
            for (let i = 0; i < 20; i++) {
                const projectData = {
                    name: `Test Project ${i + 1}`,
                    description: `Test project number ${i + 1} for performance testing`,
                    technologies: 'Test, Performance, Load',
                    category: 'web',
                    status: 'completed'
                };
                
                try {
                    const response = await fetch('/api-direct.php?endpoint=projects', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(projectData)
                    });
                    
                    if (i % 5 === 0) {
                        log(`Performance test: Created ${i + 1}/20 projects`, 'info');
                    }
                } catch (error) {
                    log(`Performance test error at project ${i + 1}: ${error.message}`, 'error');
                }
                
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            showStatus('‚úÖ Test performance completato', 'success');
            setTimeout(() => loadProjects(), 1000);
        }

        async function deleteAllProjects() {
            if (!confirm('Sei sicuro di voler eliminare TUTTI i progetti?')) {
                return;
            }
            
            log('Deleting all projects...', 'warning');
            
            for (const project of appState.projects) {
                try {
                    await fetch(`/api-direct.php?endpoint=projects&id=${project.id}`, {
                        method: 'DELETE'
                    });
                } catch (error) {
                    log(`Error deleting project ${project.id}: ${error.message}`, 'error');
                }
            }
            
            showStatus('‚úÖ Tutti i progetti eliminati', 'success');
            setTimeout(() => loadProjects(), 1000);
        }

        function exportProjects() {
            const data = JSON.stringify(appState.projects, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `projects-export-${new Date().toISOString().slice(0, 19)}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            showStatus('‚úÖ Progetti esportati', 'success');
        }

        function clearConsole() {
            const console = document.getElementById('console');
            console.innerHTML = '<div class="console-line">üöÄ Console CRUD pulita</div>';
        }

        // Initialize
        window.onload = function() {
            log('CRUD test system initialized', 'success');
            showStatus('‚úÖ Sistema test CRUD inizializzato', 'success');
        };
    </script>
</body>
</html> 